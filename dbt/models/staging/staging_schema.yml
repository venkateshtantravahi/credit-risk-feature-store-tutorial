version: 2


models:
  - name: accepted_loans
    description: "Cleaned & typed LendingClub accepted loans."
    columns:
      - name: loan_id
        tests:
          - not_null
      - name: customer_id
        tests:
          - not_null
      - name: term
        tests:
          - accepted_values:
              arguments:
                values: ["36 months", "60 months"]
                quote: true
      - name: int_rate_pct
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 100
                inclusive: true
      - name: revol_util_pct
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 200
                inclusive: true
              config:
                severity: warn
      - name: total_pymnt
        description: "Total payment received to date"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0   # payments should not be negative
      - name: total_pymnt_inv
        description: "Total payments received by investors"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
      - name: total_rec_prncp
        description: "Total principal received"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
      - name: total_rec_int
        description: "Total interest received"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
      - name: total_rec_late_fee
        description: "Total late fees received"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
              config:
                severity: warn
      - name: recoveries
        description: "Post charge-off recoveries"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
      - name: collection_recovery_fee
        description: "Collection recovery fee charged"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

  - name: rejected_loans
    description: "Cleaned & typed LendingClub rejected loans."
    columns:
      - name: amount_requested
        description: "Requested loan amount at application"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: risk_score
        description: "Risk score reported at application (when available)"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0

      - name: dti_ratio_pct
        description: "Debt-to-income ratio as a percent (e.g., 15.3)"
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 200
                inclusive: true
              config:
                severity: warn

      - name: application_date
        description: "Parsed application date"
        tests:
          - not_null

      - name: state
        description: "US state/territory code"
        tests:
          - accepted_values:
              arguments:
                values: ["AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"]
                quote: true
              config:
                severity: warn

      - name: event_timestamp
        description: "Timestamp proxy for the application time"
        tests:
          - not_null